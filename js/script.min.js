var selectOptionNumber=0,countryData=void 0,countdownEndtime=0,eventIndex=0;function setSelectOptionNumber(init){$(window).width()>=768?(selectOptionNumber=9,init||$("#video_multiselect").multiselect("updateButtonText")):(9==selectOptionNumber&&(selectOptionNumber=3,mobileStreamings()),selectOptionNumber=3),disableOptions()}function getStreamingOptions(streamings){return count=0,streamingOptions=streamings.map((function(item){return item.selected&&(count+=1),{label:item.location_name,title:item.location_name,value:item.id,selected:count<=selectOptionNumber&&item.selected}})),streamingOptions}function appendStreaming(streaming){$("#streaming_list").append('<div class="col-lg-4 col-md-6 streaming-video mb-4" id="streaming_video_'+streaming.id+'"><iframe id="player" width=100% height=100% src="https://www.youtube.com/embed/'+streaming.youtube_id+'?autoplay=1&mute=1&info=0&controls=0" frameborder="0"></iframe></div>'),adjustStreamingsHeight()}function removeStreaming(id){$("#streaming_video_"+id).remove()}function findStreaming(id){return streamings.find(item=>item.id==id)}function mobileStreamings(){ids=[],$(".streaming-video").each((function(index,value){index>=selectOptionNumber&&($(this).remove(),ids.push($(this)[0].id.split("_")[2]))})),$("#video_multiselect").multiselect("deselect",ids)}function disableOptions(){var selectedOptions,nonSelectedOptions;$("#video_multiselect option:selected").length>=selectOptionNumber?$("#video_multiselect option").filter((function(){return!$(this).is(":selected")})).each((function(){var input=$('input[value="'+$(this).val()+'"]');input.prop("disabled",!0),input.closest("li").addClass("disabled")})):$("#video_multiselect option").each((function(){var input=$('input[value="'+$(this).val()+'"]');input.prop("disabled",!1),input.closest("li").removeClass("disabled")}))}function adjustStreamingsHeight(){$(".streaming-video").each((function(){$(this).height($(this).width()/16*9)}))}function setCountrySelection(){selections=getCountdownOptions();for(var i=0;i<selections.length;i++)$("#country_selection").append('<option value="'+selections[i].value+'"'+(selections[i].default?" selected":"")+">"+selections[i].name+"</option>")}function getCountdownOptions(){return countdowns.map((function(item){return{name:item.display_name,value:item.name,default:item.default}}))}function findCountdown(val){return countdowns.find(item=>item.name==val)}function getTimestamp(){return parseInt(Date.now()/1e3)}function getTimeRemaining(endtime){tmp_total=endtime-getTimestamp();const total=tmp_total<=0?0:parseInt(tmp_total),seconds=Math.floor(total%60),minutes=Math.floor(total/60%60),hours=Math.floor(total/3600%24),days=Math.floor(total/86400);return{total:total,days:days,hours:hours,minutes:minutes,seconds:seconds}}function initializeClock(){countryData=findCountdown($("#country_selection").val()),currentTimestamp=getTimestamp(),countdownEndtime=0;for(var i=0;i<countryData.events.length;i++)if(countryData.events[i].time>currentTimestamp){countdownEndtime=countryData.events[i].time,eventIndex=i,$("#event_name").text(countryData.events[i].display_name),$("#event_time").text("("+toTimeFormat(countdownEndtime)+")");break}const daysSpan=$("#event_days"),hoursSpan=$("#event_hours"),minutesSpan=$("#event_minutes"),secondsSpan=$("#event_seconds");function updateClock(){const t=getTimeRemaining(countdownEndtime);$("#event_name").text(countryData.events[eventIndex].display_name),$("#event_time").text("("+toTimeFormat(countdownEndtime)+")"),daysSpan.text(t.days<10?("0"+t.days).slice(-2):t.days),hoursSpan.text(("0"+t.hours).slice(-2)),minutesSpan.text(("0"+t.minutes).slice(-2)),secondsSpan.text(("0"+t.seconds).slice(-2)),t.days+t.hours+t.minutes+t.seconds===0?$("#event_days_div").removeClass("hide"):0===t.days&&$("#event_days_div").addClass("hide"),t.total<=0&&(eventIndex<countryData.events.length-1?(eventIndex+=1,countdownEndtime=countryData.events[eventIndex].time):clearInterval(timeinterval))}updateClock();const timeinterval=setInterval(updateClock,1e3)}function toTimeFormat(unixTime){return date=new Date(1e3*unixTime),year=date.getYear()+1900,month="0"+(date.getMonth()+1),day="0"+date.getDate(),hour="0"+date.getHours(),minute="0"+date.getMinutes(),second="0"+date.getSeconds(),year+"-"+month.substr(-2)+"-"+day.substr(-2)+" "+hour.substr(-2)+":"+minute.substr(-2)+":"+second.substr(-2)}$(document).ready((function(){setSelectOptionNumber(!0),setCountrySelection(),initializeClock(),$(window).on("resize",(function(){setSelectOptionNumber(),adjustStreamingsHeight()})),$("#country_selection").on("change",(function(){countryData=findCountdown($(this).val()),currentTimestamp=getTimestamp(),countdownEndtime=0;for(var i=0;i<countryData.events.length;i++)if(countryData.events[i].time>currentTimestamp){countdownEndtime=countryData.events[i].time,eventIndex=i;break}countdownEndtime>getTimestamp()&&(console.log("initializeClock();"),initializeClock())})),$("#video_multiselect").multiselect({nonSelectedText:"請選擇至少一個頻道",enableHTML:!0,onChange:function(item,insert){if(id=item[0].value,insert){const streaming=findStreaming(id);appendStreaming(streaming)}else removeStreaming(id);disableOptions()},buttonText:function(options,select){return 0===options.length?"請選擇至少一個頻道":options.length==selectOptionNumber?'<span class="text-danger font-weight-bold">上限選擇 '+options.length+" 個頻道</span>":"已選擇 "+options.length+" 個頻道"}}),$("#video_multiselect").multiselect("dataprovider",getStreamingOptions(streamings)),selected_options=$("#video_multiselect option:selected").map((function(a,item){return item.value}));for(var i=0;i<selected_options.length&&i<selectOptionNumber;i++){const streaming=findStreaming(selected_options[i]);appendStreaming(streaming)}disableOptions(),adjustStreamingsHeight()}));